<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>寶可夢卡磚專賣店</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; margin: 0; background: #f6f6f6; color: #333; }
    header { background: #2c3e50; color: white; padding: 1em; text-align: center; }
    .category-bar-wrapper { display: flex; align-items: center; background: #fff; padding: 0.5em; border-bottom: 1px solid #ccc; }
    .category-bar { display: flex; overflow-x: auto; flex: 1; gap: 10px; white-space: nowrap; }
    .category-bar span { background: #fff; padding: 0.5em 1em; border-radius: 20px; border: 1px solid #ccc; cursor: pointer; }
    .category-bar span.active { background: orange; color: white; }
    .container { max-width: 1200px; margin: auto; padding: 2em 1em; }
    .grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* 每列固定兩欄 */
  gap: 1em;
}    .card { background: #fff; border-radius: 10px; padding: 1em; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .card img { width: 90%; border-radius: 6px; object-fit: cover; }
    .price { color: #e67e22; font-weight: bold; margin: 0.5em 0; }
    .fixed-bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 0.5em; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 1000; }
    .fixed-bottom-bar button { flex: 1; margin: 0 0.5em; padding: 0.5em; border-radius: 999px; font-weight: bold; background: gray; color: white; border: none; }
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 10001; }
    .modal.show { display: flex; }
    .modal-content { background: #fff; padding: 1.5em; border-radius: 10px; width: 90%; max-width: 400px; text-align: center; position: relative; }
    .modal-content img { width: 100%; border-radius: 8px; margin-bottom: 1em; }
    .close { position: absolute; top: 10px; right: 15px; font-size: 1.5em; cursor: pointer; }
    select, .modal-content button { width: 100%; padding: 0.7em; margin-top: 1em; border-radius: 5px; border: none; }
    .modal-content button { background-color: #27ae60; color: white; font-weight: bold; cursor: pointer; }
    .toggle-expand { font-size: 1.5em; background: none; border: none; cursor: pointer; margin-left: 10px; }
    .modal-content-large {
  background: #fff;
  padding: 1em;
  border-radius: 10px;
  width: 90%;
  max-width: 700px;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.category-grid-modal {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1em;
  width: 100%;
}

.category-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #f9f9f9;
  border-radius: 10px;
  padding: 1em;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.category-card:hover {
  transform: scale(1.03);
}
.category-card img {
  width: 100%;
  max-width: 150px;
  border-radius: 8px;
  margin-bottom: 0.5em;
}
.category-card div {
  font-weight: bold;
  text-align: center;
}

    .category-expand {
  display: none;
  background: white;
  position: fixed;
  top: 10%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 600px;
  max-height: 80vh;
  overflow: hidden;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  flex-direction: column;
  z-index: 9999;
}
    .category-expand.show { display: flex; flex-direction: column; }
    .category-expand .header { display: flex; justify-content: space-between; align-items: center; padding: 1em; border-bottom: 1px solid #ccc; }
    
  </style>
</head>
<body>
<header>
  <h1>KAMI KAMI TCG</h1>
</header>
<div class="category-bar-wrapper">
  <div class="category-bar" id="categoryBar"></div>
  <button class="toggle-expand" onclick="toggleExpand()">▾</button>
</div>
<div class="category-expand" id="categoryExpand">
  <div class="header">
    <strong>選擇分類</strong>
    <button onclick="toggleExpand()">✕</button>
  </div>
  <div class="category-grid" id="categoryGrid"><div class="category-grid-item"><img src="https://placehold.co/300x200?text=%E5%A4%AA%E6%99%B6%E6%85%B6%E5%85%B8-%E4%BC%8A%E5%B8%83"><div>太晶慶典-伊布</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=%E7%9A%AE%E5%8D%A1%E4%B8%98%E7%B3%BB%E5%88%97"><div>皮卡丘系列</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=%E5%99%B4%E7%81%AB%E9%BE%8D%E7%B3%BB%E5%88%97"><div>噴火龍系列</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=%E5%A5%87%E6%A8%B9%E7%B3%BB%E5%88%97"><div>奇樹系列</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=%E8%8E%89%E8%8E%89%E8%89%BE%E7%B3%BB%E5%88%97"><div>莉莉艾系列</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=151%E7%B3%BB%E5%88%97"><div>151系列</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=%E7%86%B1%E9%96%80V%26Vmax%E7%B3%BB%E5%88%97"><div>熱門V&amp;Vmax系列</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV9%E5%B0%8D%E6%88%B0%E5%A4%A5%E4%BC%B4"><div>SV9對戰夥伴</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV8%E8%B6%85%E9%9B%BB%2F%E5%A4%AA%E6%99%B6"><div>SV8超電/太晶</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV7%E9%BE%8D%E9%A8%B0%2F%E6%98%9F%E6%99%B6"><div>SV7龍騰/星晶</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV6%E8%AE%8A%E5%B9%BB%E5%81%87%E9%9D%A2"><div>SV6變幻假面</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV5%E7%B7%8B%E7%B4%85%2F%E7%95%B0%E5%BA%A6%E7%8B%82%E9%87%8E"><div>SV5緋紅/異度狂野</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV4a%20%E9%96%83%E8%89%B2%E5%AF%B6%E8%97%8F"><div>SV4a 閃色寶藏</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV3%20%E9%BB%AF%E7%82%8E%2F%E6%BF%80%E7%8B%82"><div>SV3 黯炎/激狂</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV2%20%E7%A2%9F%E6%97%8B%2F%E5%86%B0%E9%9B%AA"><div>SV2 碟旋/冰雪</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=SV1%20%E6%9C%B1%E7%B4%AB%2F%E9%9F%B3%E7%88%86"><div>SV1 朱紫/音爆</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=Vstar%E5%A4%A9%E5%9C%B0%E8%90%AC%E7%89%A9"><div>Vstar天地萬物</div></div><div class="category-grid-item"><img src="https://placehold.co/300x200?text=%E4%BC%8A%E5%B8%83%E8%8B%B1%E9%9B%84%E7%B3%BB%E5%88%97"><div>伊布英雄系列</div></div></div>
</div>
<div class="container" >
  <h4 id="current-category">介紹</h2>
  <div class="grid" id="productGrid"></div>
</div>

<div class="modal" id="categoryModal">
  <div class="modal-content-large">
    <span class="close" onclick="closeCategoryModal()">✕</span>
    <h3 style="margin-bottom: 1em;">選擇分類</h3>
    <div class="category-grid-modal" id="categoryModalGrid"></div>
  </div>
</div>
<div class="modal" id="variantModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">✕</span>
    <h3 id="modalTitle"></h3>
    <img id="modalImage" src="" alt="">
    <div class="price" id="modalPrice"></div>
    <select id="variantSelect" onchange="changeVariantInfo()"></select>
    <button onclick="addToCart()">加入購物車</button>
  </div>
</div>
<!-- ✅ 通用提示用 Modal -->
<div class="modal" id="alertModal">
  <div class="modal-content">
    <span class="close" onclick="closeAlertModal()">✕</span>
    <h3 id="alertModalMessage"></h3>
  </div>
</div>

<!-- ✅ 結帳成功 Modal -->
<div class="modal" id="checkoutModal">
  <div class="modal-content">
    <span class="close" onclick="closeCheckoutModal()">✕</span>
    <h3>訂購完成！</h3>
    <p>請查看您的 LINE 確認訂單資訊。</p>
    <button onclick="closeCheckoutModal()">關閉</button>
  </div>
</div>

<div id="cartPage" style="display: none; padding: 2em;">
  <h2>購物車明細</h2>
  <div id="cartItems"></div>

  <div style="margin-top: 2em;">
    <input type="text" id="discountCodeInput" placeholder="輸入折扣碼" style="width: 60%; padding: 0.5em; border-radius: 5px; border: 1px solid #ccc;">
    <button onclick="applyDiscount()" style="padding: 0.5em 1em; margin-left: 1em; border-radius: 5px; background: #27ae60; color: white; border: none;">套用折扣</button>
    <button onclick="backToHome()" style="margin-top: 2em; padding: 0.5em 1em; background: gray; color: white; border: none; border-radius: 5px;">回到首頁</button>

  </div>

  <div style="margin-top: 2em; font-size: 1.2em;">
    <p>商品總金額：$<span id="totalAmount">0</span></p>
    <p>折扣金額：$<span id="discountAmount">0</span></p>
    <p><strong>折扣後金額：$<span id="finalAmount">0</span></strong></p>
  </div>
  <div style="margin-top: 2em; text-align: center;">
    <button onclick="submitOrder()" style="padding: 0.8em 2em; font-size: 1em; border-radius: 999px; background: orange; color: white; border: none;">送出訂單</button>
  </div>
</div>

<div class="fixed-bottom-bar">
  <button onclick="goToIntro()" id="introBtn" style="display:none; background: orange;">其他周邊・卡磚</button>
  <button id="cartButton" onclick="toggleCartList()">購物車 (0)</button>
</div>
<script>
  const categoryBar = document.getElementById('categoryBar');
  const productGrid = document.getElementById('productGrid');
  const modal = document.getElementById('variantModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalImage = document.getElementById('modalImage');
  const modalPrice = document.getElementById('modalPrice');
  const variantSelect = document.getElementById('variantSelect');
  const cartButton = document.getElementById('cartButton');
  
  let currentVariants = [];
  let currentItem = {};
  let cart = [];
  
  const data = {
    "商品大項": [
      ...[
        "太晶慶典-伊布", "皮卡丘系列", "噴火龍系列", "奇樹系列", "莉莉艾系列",
        "151系列", "熱門V&Vmax系列", "SV9對戰夥伴", "SV8超電/太晶", "SV7龍騰/星晶",
        "SV6變幻假面", "SV5緋紅/異度狂野", "SV4a 閃色寶藏", "SV3 黯炎/激狂",
        "SV2 碟旋/冰雪", "SV1 朱紫/音爆", "Vstar天地萬物", "伊布英雄系列"
      ].map(cat => ({
        "商品大項名稱": cat,
        "商品大項圖片": `./img/demo1.png`,
        "小項價格範圍": "$100–$300",
        "商品小項": [
          { "商品小項名稱": `${cat} Demo商品1`, "商品小項價格": 100, "商品小項圖片": `./img/demo1.png` },
          { "商品小項名稱": `${cat} Demo商品2`, "商品小項價格": 150, "商品小項圖片": `./img/demo2.png` },
          { "商品小項名稱": `${cat} Demo商品3`, "商品小項價格": 200, "商品小項圖片": `./img/demo3.png` }
        ]
      }))
    ]
  };
  
  function loadCategories() {
    const introSpan = document.createElement('span');
    introSpan.textContent = '介紹';
    introSpan.onclick = goToIntro;
    categoryBar.appendChild(introSpan);
  
    data.商品大項.forEach(cat => {
      const span = document.createElement('span');
      span.textContent = cat.商品大項名稱;
      span.onclick = () => renderCategory(cat);
      categoryBar.appendChild(span);
    });
  }
  
  function renderCategory(category) {
    document.getElementById('current-category').innerText = category.商品大項名稱;
    document.querySelectorAll('.category-bar span').forEach(s => s.classList.remove('active'));
    [...categoryBar.children].forEach(s => {
      if (s.textContent === category.商品大項名稱) s.classList.add('active');
    });
    productGrid.innerHTML = '';
    category.商品小項.forEach((item) => {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <img src="${item.商品小項圖片}" alt="${item.商品小項名稱}" style="border: 4px solid black; border-radius: 10px;">
        <h4>${item.商品小項名稱}</h4>
        <div onclick='openVariantModal(${JSON.stringify(category)}, ${JSON.stringify(item)})' style="color: gray; font-size: 0.9em;">選擇款式</div>
        <div class="price">$${item.商品小項價格}–680</div>
      `;
      productGrid.appendChild(div);
    });
    document.getElementById('introBtn').style.display = 'inline-block';
  }
  
  function openVariantModal(category, item) {
    currentVariants = category.商品小項;
    currentItem = item;
    modal.classList.add('show');
    updateModal(item);
    variantSelect.innerHTML = '';
    currentVariants.forEach((variant, idx) => {
      const opt = document.createElement('option');
      opt.value = idx;
      opt.textContent = variant.商品小項名稱;
      if (variant.商品小項名稱 === item.商品小項名稱) opt.selected = true;
      variantSelect.appendChild(opt);
    });
  }
  
  function updateModal(item) {
    modalTitle.innerText = item.商品小項名稱;
    modalImage.src = item.商品小項圖片;
    modalPrice.innerText = `$${item.商品小項價格}`;
  }
  
  function changeVariantInfo() {
    const idx = variantSelect.value;
    const selected = currentVariants[idx];
    currentItem = selected;
    updateModal(selected);
  }
  
  function closeModal() {
    modal.classList.remove('show');
  }
  
  function addToCart() {
    cart.push(currentItem);
    cartButton.innerText = `購物車 (${cart.length})`;
    alert(`已加入購物車：${currentItem.商品小項名稱}`);
    closeModal();
  }
  
  function goToIntro() {
    document.getElementById('current-category').innerText = '介紹';
    productGrid.innerHTML = `
      <div class='card'><img src='./img/demo1.png'><h4>擴散式卡磚</h4></div>
      <div class='card'><img src='./img/demo2.png'><h4>擴散式鑑定卡殼</h4></div>
      <div class='card'><img src='./img/demo3.png'><h4>卡牌周邊</h4></div>
    `;
    document.querySelectorAll('.category-bar span').forEach(s => s.classList.remove('active'));
    categoryBar.children[0].classList.add('active');
    document.getElementById('introBtn').style.display = 'none';
  }
  
  function toggleCartList() {
    alert(`目前購物車有 ${cart.length} 項商品`);
  }
  const categoryModal = document.getElementById('categoryModal');
const categoryModalGrid = document.getElementById('categoryModalGrid');

function toggleExpand() {
  categoryModal.classList.add('show');
  loadCategoryModal();
}

function closeCategoryModal() {
  categoryModal.classList.remove('show');
}

function loadCategoryModal() {
  categoryModalGrid.innerHTML = '';
  data.商品大項.forEach(cat => {
    const div = document.createElement('div');
    div.className = 'category-card';
    div.innerHTML = `
      <img src="./img/decks.png" alt="${cat.商品大項名稱}">
      <div>${cat.商品大項名稱}</div>
    `;
    div.onclick = () => {
      closeCategoryModal();
      renderCategory(cat);
    };
    categoryModalGrid.appendChild(div);
  });
}

  loadCategories();
  goToIntro();

  // ✅ 通用 alert Modal 顯示
function showAlertModal(message, autoClose = false) {
  document.getElementById('alertModalMessage').innerText = message;
  document.getElementById('alertModal').classList.add('show');
  if (autoClose) {
    setTimeout(() => {
      closeAlertModal();
    }, 2000); // 2秒後自動關閉
  }
}

function closeAlertModal() {
  document.getElementById('alertModal').classList.remove('show');
}

// ✅ 結帳成功 Modal
function showCheckoutModal() {
  document.getElementById('checkoutModal').classList.add('show');
}

function closeCheckoutModal() {
  document.getElementById('checkoutModal').classList.remove('show');
}

// ✅ 修改原本加入購物車的函數
function addToCart() {
  cart.push(currentItem);
  cartButton.innerText = `購物車 (${cart.length})`;
  showAlertModal(`已加入購物車：${currentItem.商品小項名稱}`, true); // 2秒後自動關
  closeModal();
}

function toggleCartList() {
  if (cart.length === 0) {
    showAlertModal("購物車是空的喔！", true);
    return;
  }
  document.querySelector('.container').style.display = 'none'; 
  document.querySelector('.category-bar-wrapper').style.display = 'none';
  document.getElementById('cartPage').style.display = 'block';
  document.getElementById('introBtn').style.display = 'none'; // ← 新增這行
  
  renderCartItems();
}
function renderCartItems() {
  const cartItems = document.getElementById('cartItems');
  cartItems.innerHTML = '';

  if (cart.length === 0) {
    showAlertModal("購物車清空，返回首頁。", true);
    setTimeout(() => {
      backToHome();
    }, 2000); // 2秒後回首頁
    return;
  }

  cart.forEach((item, idx) => {
    const div = document.createElement('div');
    div.style.display = 'flex';
    div.style.justifyContent = 'space-between';
    div.style.alignItems = 'center';
    div.style.padding = '1em 0';
    div.style.borderBottom = '1px solid #ddd';
    div.innerHTML = `
      <div>
        <strong>${item.商品小項名稱}</strong><br>
        <small>$${item.商品小項價格}</small>
      </div>
      <button onclick="removeCartItem(${idx})" style="padding: 0.3em 0.6em; border-radius: 5px; background: red; color: white; border: none;">移除</button>
    `;
    cartItems.appendChild(div);
  });

  updateCartSummary();
}

function updateCartSummary() {
  const total = cart.reduce((sum, item) => sum + item.商品小項價格, 0);
  const discount = total * currentDiscount;
  const finalTotal = total - discount;

  document.getElementById('totalAmount').innerText = total.toFixed(0);
  document.getElementById('discountAmount').innerText = discount.toFixed(0);
  document.getElementById('finalAmount').innerText = finalTotal.toFixed(0);

  cartButton.innerText = `購物車 (${cart.length})`;
}

function applyDiscount() {
  const code = document.getElementById('discountCodeInput').value.trim();
  if (code === "PIKA10") {
    currentDiscount = 0.1;
    showAlertModal("成功套用 PIKA10 折扣碼！", true);
  } else if (code === "DRAGON20") {
    currentDiscount = 0.2;
    showAlertModal("成功套用 DRAGON20 折扣碼！", true);
  } else {
    currentDiscount = 0;
    showAlertModal("無效的折扣碼，請重新輸入。", true);
  }
  updateCartSummary();
}

function removeCartItem(index) {
  cart.splice(index, 1);
  renderCartItems();
}
function backToHome() {
  document.getElementById('cartPage').style.display = 'none';
  document.querySelector('.container').style.display = 'block';
  document.querySelector('.category-bar-wrapper').style.display = 'flex';
  document.getElementById('introBtn').style.display = 'inline-block'; // 恢復橘色按鈕
  loadCategories(); // 重載分類
  goToIntro(); // 回首頁商品
}

function submitOrder() {
  if (cart.length === 0) {
    showAlertModal("購物車是空的，無法送出訂單。", true);
    return;
  }

  showCheckoutModal(); // ✅ 呼叫原本的訂單完成Modal

  // 可選：這邊可以加上 "清空購物車"
  cart = [];
  cartButton.innerText = `購物車 (0)`;

  // 回到首頁
  setTimeout(() => {
    closeCheckoutModal();
    backToHome();
  }, 3000); // 3秒後自動回首頁
}
  </script>
  
</body>
</html>
