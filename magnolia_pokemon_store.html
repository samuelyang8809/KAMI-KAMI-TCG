<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KAMI KAMI TCG</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; margin: 0; background: #f6f6f6; color: #333; }
    header { background: #2c3e50; color: white; padding: 1em; text-align: center; position: relative; }
    .cart-button { position: absolute; right: 1em; top: 1em; background: #e67e22; color: white; padding: 0.5em 1em; border: none; border-radius: 5px; cursor: pointer; }
    .category-bar-wrapper { display: flex; align-items: center; background: #fff; padding: 0.5em; border-bottom: 1px solid #ccc; }
    .category-bar { display: flex; overflow-x: auto; flex: 1; gap: 10px; white-space: nowrap; }
    .category-bar span { background: #fff; padding: 0.5em 1em; border-radius: 20px; border: 1px solid #ccc; cursor: pointer; }
    .category-bar span.active { background: orange; color: white; }
    .toggle-expand { font-size: 1.5em; background: #eee; border: none; cursor: pointer; margin-left: 10px; padding: 0.2em 0.5em; border-radius: 8px; }
    .category-expand { display: none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 90%; max-width: 600px; max-height: 80vh; background: white; overflow-y: auto; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 9999; flex-direction: column; }
    .category-expand.show { display: flex; }
    .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1em; padding: 1em; }
    .category-grid-item img { width: 100%; border-radius: 8px; }
    .container { max-width: 1200px; margin: auto; padding: 1em 1em; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1em; }
    .card { background: #fff; border-radius: 10px; padding: 1em; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .card img { width: 85%; border-radius: 6px; }
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 9999; }
    .modal-content { background: #fff; padding: 2em; border-radius: 10px; max-width: 400px; width: 90%; text-align: center; position: relative; }
    .close { position: absolute; top: 10px; right: 15px; font-size: 1.2em; cursor: pointer; }
    select { width: 100%; padding: 0.5em; font-size: 1em; margin-bottom: 1em; }
    button { padding: 0.7em 1.5em; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .fixed-bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 0.5em 0; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 10000; }
    .fixed-bottom-bar button { flex: 1; margin: 0 0.5em; border-radius: 999px; font-weight: bold; }
    #cartListModal { display: none; position: fixed; bottom: 60px; left: 10px; right: 10px; background: white; border: 1px solid #ccc; border-radius: 10px; max-height: 50vh; overflow-y: auto; padding: 1em; z-index: 10001; }
  </style>
</head>
<body>
<header>
  <h1>KAMI KAMI TCG</h1>
</header>

<div class="category-bar-wrapper">
  <div class="category-bar" id="categoryBar"></div>
  <button class="toggle-expand" onclick="toggleExpand()">▼</button>
</div>

<div class="category-expand" id="categoryExpand">
  <div class="header" style="display: flex; justify-content: space-between; align-items: center; padding: 1em; border-bottom: 1px solid #ccc;">
    <strong>選擇分類</strong>
    <button onclick="toggleExpand()">✕</button>
  </div>
  <div class="category-grid" id="categoryGrid"></div>
</div>

<div class="container">
  <h3 id="current-category">介紹</h2>
  <div class="grid" id="productGrid">
    <div class="card"><img src="https://placehold.co/300x400?text=擴散式卡磚"><h4>擴散式卡磚</h4></div>
    <div class="card"><img src="https://placehold.co/300x400?text=擴散式鑑定卡殼"><h4>擴散式<font color="red">鑑定</font>卡殼</h4></div>
    <div class="card"><img src="https://placehold.co/300x400?text=卡牌周邊"><h4>卡牌周邊</h4></div>
  </div>
</div>

<div id="variantModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">✕</span>
    <h3 id="modal-product-name"></h3>
    <img id="modal-product-image" src="" alt="" style="margin-bottom: 1em;">
    <div>
      <select id="variantSelect" onchange="changeVariantInfo()"></select>
    </div>
    <div id="modal-product-price" style="margin-bottom: 1em;"></div>
    <button onclick="addToCart()">加入購物車</button>
  </div>
</div>

<div id="cartListModal"></div>

<div class="fixed-bottom-bar">
  <button onclick="goToIntro()" id="introBtn" style="display:none; background: orange; color: white;">其他周邊・卡磚</button>
  <button onclick="toggleCartList()" style="background: gray; color: white;">購物車</button>
</div>

<script>
const productGrid = document.getElementById('productGrid');
const categoryBar = document.getElementById('categoryBar');
const categoryGrid = document.getElementById('categoryGrid');
const cart = [];
let currentItem = {};
let currentVariants = [];
let isIntro = true;

const data = {
    "商品大項": [
      ...[
        "太晶慶典-伊布", "皮卡丘系列", "噴火龍系列", "奇樹系列", "莉莉艾系列",
        "151系列", "熱門V&Vmax系列", "SV9對戰夥伴", "SV8超電/太晶", "SV7龍騰/星晶",
        "SV6變幻假面", "SV5緋紅/異度狂野", "SV4a 閃色寶藏", "SV3 黯炎/激狂",
        "SV2 碟旋/冰雪", "SV1 朱紫/音爆", "Vstar天地萬物", "伊布英雄系列"
      ].map(cat => ({
        "商品大項名稱": cat,
        "商品大項圖片": `https://placehold.co/600x400?text=${encodeURIComponent(cat)}`,
        "小項價格範圍": "$100–$300",
        "商品小項": [
          { "商品小項名稱": `${cat} Demo商品1`, "商品小項價格": 100, "商品小項圖片": `https://placehold.co/300x400?text=${encodeURIComponent(cat)}+Demo1` },
          { "商品小項名稱": `${cat} Demo商品2`, "商品小項價格": 150, "商品小項圖片": `https://placehold.co/300x400?text=${encodeURIComponent(cat)}+Demo2` },
          { "商品小項名稱": `${cat} Demo商品3`, "商品小項價格": 200, "商品小項圖片": `https://placehold.co/300x400?text=${encodeURIComponent(cat)}+Demo3` }
        ]
      }))
    ]
  };

const introSpan = document.createElement('span');
introSpan.textContent = '介紹';
introSpan.onclick = goToIntro;
categoryBar.appendChild(introSpan);

const introGridItem = document.createElement('div');
introGridItem.className = 'category-grid-item';
introGridItem.innerHTML = `<img src="https://placehold.co/600x400?text=介紹"><div>介紹</div>`;
introGridItem.onclick = () => { goToIntro(); toggleExpand(); };
categoryGrid.appendChild(introGridItem);

data.商品大項.forEach(cat => {
  const span = document.createElement('span');
  span.textContent = cat.商品大項名稱;
  span.onclick = () => selectCategory(cat);
  categoryBar.appendChild(span);

  const gridItem = document.createElement('div');
  gridItem.className = 'category-grid-item';
  gridItem.innerHTML = `<img src="${cat.商品大項圖片}"><div>${cat.商品大項名稱}</div>`;
  gridItem.onclick = () => { selectCategory(cat); toggleExpand(); };
  categoryGrid.appendChild(gridItem);
});

function selectCategory(category) {
  document.querySelectorAll('.category-bar span').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.category-bar span').forEach(s => {
    if (s.textContent === category.商品大項名稱) s.classList.add('active');
  });
  document.getElementById('current-category').innerText = category.商品大項名稱;
  productGrid.innerHTML = '';
  currentVariants = category.商品小項;
  category.商品小項.forEach(item => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <img src="${item.商品小項圖片}" alt="${item.商品小項名稱}">
      <h4>${item.商品小項名稱}</h4>
      <p style="color:#e67e22">$${item.商品小項價格}</p>
      <button onclick='openVariantModal(${JSON.stringify(category)}, ${JSON.stringify(item)})'>選擇款式</button>
    `;
    productGrid.appendChild(div);
  });
  isIntro = false;
  document.getElementById('introBtn').style.display = 'inline-block';
}

function openVariantModal(category, item) {
  currentItem = item;
  currentVariants = category.商品小項;
  document.getElementById('modal-product-name').innerText = item.商品小項名稱;
  document.getElementById('modal-product-image').src = item.商品小項圖片;
  document.getElementById('modal-product-price').innerText = `$${item.商品小項價格}`;
  const select = document.getElementById('variantSelect');
  select.innerHTML = '';
  currentVariants.forEach((variant, idx) => {
    const opt = document.createElement('option');
    opt.value = idx;
    opt.textContent = variant.商品小項名稱;
    select.appendChild(opt);
  });
  document.getElementById('variantModal').style.display = 'flex';
}

function closeModal() {
  document.getElementById('variantModal').style.display = 'none';
}

function changeVariantInfo() {
  const idx = document.getElementById('variantSelect').value;
  const selected = currentVariants[idx];
  document.getElementById('modal-product-name').innerText = selected.商品小項名稱;
  document.getElementById('modal-product-image').src = selected.商品小項圖片;
  document.getElementById('modal-product-price').innerText = `$${selected.商品小項價格}`;
  currentItem = selected;
}

function toggleExpand() {
  document.getElementById('categoryExpand').classList.toggle('show');
}

function addToCart() {
  cart.push({...currentItem});
  alert(`已加入：${currentItem.商品小項名稱}`);
  closeModal();
  updateCartList();
}

function updateCartList() {
  const cartListModal = document.getElementById('cartListModal');
  if (cart.length === 0) {
    cartListModal.innerHTML = '<p>購物車是空的</p>';
  } else {
    cartListModal.innerHTML = cart.map(item => `<div style='margin-bottom: 0.5em;'>${item.商品小項名稱} - $${item.商品小項價格}</div>`).join('');
  }
}

function toggleCartList() {
  const cartListModal = document.getElementById('cartListModal');
  if (cartListModal.style.display === 'block') {
    cartListModal.style.display = 'none';
  } else {
    updateCartList();
    cartListModal.style.display = 'block';
  }
}

function goToIntro() {
  document.querySelectorAll('.category-bar span').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.category-bar span').forEach(s => {
    if (s.textContent === '介紹') s.classList.add('active');
  });
  document.getElementById('current-category').innerText = '介紹';
  productGrid.innerHTML = `
    <div class="card"><img src="https://placehold.co/300x400?text=擴散式卡磚"><h4>擴散式卡磚</h4></div>
    <div class="card"><img src="https://placehold.co/300x400?text=擴散式鑑定卡殼"><h4>擴散式<font color='red'>鑑定</font>卡殼</h4></div>
    <div class="card"><img src="https://placehold.co/300x400?text=卡牌周邊"><h4>卡牌周邊</h4></div>
  `;
  document.getElementById('introBtn').style.display = 'none';
  isIntro = true;
}
</script>

</body>
</html>
